<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tecnaria GOLD</title>

    <style>
        body {
            background-color: #0f1116;
            color: #e2e2e2;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #app {
            display: flex;
            height: 100vh;
        }
        #sidebar {
            width: 300px;
            background-color: #161922;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            gap: 20px;
            color: white;
        }
        #main {
            flex: 1;
            padding: 40px;
        }
        .button {
            background-color: #ff7a00;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        #responseBox {
            background-color: #1c1f26;
            padding: 20px;
            border-radius: 10px;
            min-height: 200px;
            margin-top: 20px;
            font-size: 18px;
        }
        #userInputContainer {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
        }
        #userInput {
            flex: 1;
            padding: 15px;
            font-size: 18px;
            border-radius: 10px;
            border: none;
        }
        #sendButton {
            padding: 15px 25px;
            font-size: 18px;
            background-color: #ff7a00;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: white;
        }
    </style>
</head>

<body>
    <div id="app">

        <!-- SIDEBAR ------------------------------------------------------------ -->
        <div id="sidebar">
            <h2>TECNARIA</h2>
            <p>ASSISTENZA TECNICA GOLD</p>

            <div class="button" onclick="quickQuestion('Controllo colpo P560')">Controllo colpo P560</div>
            <div class="button" onclick="quickQuestion('Lamiera / card dubbia')">Lamiera / card dubbia</div>
            <div class="button" onclick="quickQuestion('Divieti di posa CTF')">Divieti di posa CTF</div>
        </div>

        <!-- MAIN --------------------------------------------------------------- -->
        <div id="main">
            <h1>Assistente Tecnaria • Modalità GOLD</h1>
            <p>CTF su lamiera grecata + P560 • Controllo colpi, card e limiti di posa</p>

            <div id="responseBox">
                Benvenuto nell’assistente tecnico GOLD Tecnaria.<br/><br/>
                Puoi chiedermi:<br/>
                • come verificare se un colpo P560 è valido;<br/>
                • cosa fare con card sospette o lamiere irregolari;<br/>
                • in quali casi i CTF su lamiera non sono ammessi.<br/><br/>

                <span style="color:#ff7a00">Motore GOLD attivo</span>
            </div>

            <div id="userInputContainer">
                <input id="userInput" placeholder="Scrivi la tua domanda su CTF / P560 / lamiera…" />
                <button id="sendButton" onclick="sendQuestion()">Invia →</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT ------------------------------------------------------------ -->
    <script>
        function quickQuestion(text) {
            document.getElementById("userInput").value = text;
            sendQuestion();
        }

        function sendQuestion() {
            const userText = document.getElementById("userInput").value.trim();
            if (!userText) return;

            document.getElementById("responseBox").innerHTML =
                "<em>Sto elaborando la risposta…</em>";

            // ✅ CHIAMATA CORRETTA → FUNZIONA SU RENDER
            fetch("/api/ask", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ question: userText, lang: "it" })
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById("responseBox").innerHTML = data.answer || "Nessuna risposta.";
            })
            .catch(err => {
                document.getElementById("responseBox").innerHTML =
                    "<span style='color:red'>Errore chiamando il motore GOLD.</span>";
            });
        }
    </script>
</body>
</html>
