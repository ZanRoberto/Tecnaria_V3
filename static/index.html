<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Tecnaria QA Bot</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root { --bg:#f6f7fb; --fg:#222; --brand:#0d6efd; --card:#fff; --muted:#666; }
    body{margin:0;font-family:'Segoe UI',system-ui,-apple-system,Arial,sans-serif;color:var(--fg);background:var(--bg)}
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    h1{color:var(--brand);font-size:22px;margin:0 0 16px}
    .card{background:var(--card);border-radius:14px;padding:20px;box-shadow:0 6px 24px rgba(0,0,0,.06)}
    label{font-size:12px;color:var(--muted)}
    textarea{width:100%;min-height:80px;padding:12px;border-radius:10px;border:1px solid #ddd;font-size:15px;resize:vertical}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{background:var(--brand);color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
    button.secondary{background:#e9eefc;color:#174ea6}
    .answer{margin-top:16px}
    .hint{font-size:12px;color:var(--muted);margin-top:4px}
    a{color:var(--brand);text-decoration:none}
    a:hover{text-decoration:underline}
    .spinner{display:none;margin-left:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Tecnaria QA Bot</h1>
    <div class="card">
      <label for="q">Domanda</label>
      <textarea id="q" placeholder="Es. Devo usare la P560 per fissare i CTF: serve un patentino?"></textarea>
      <div class="row">
        <button id="askBtn">Chiedi</button>
        <button class="secondary" id="getBtn">usa GET (debug)</button>
        <span class="spinner" id="spin">⏳</span>
      </div>
      <div class="hint">I link nelle risposte sono cliccabili.</div>
    </div>

    <div class="card answer" id="out" hidden></div>
  </div>

  <script>
    const qEl   = document.getElementById('q');
    const outEl = document.getElementById('out');
    const spin  = document.getElementById('spin');

    function show(html){
      outEl.hidden=false;
      outEl.innerHTML = html;
      outEl.scrollIntoView({behavior:'smooth'});
    }
    function start(){ spin.style.display='inline-block'; }
    function stop(){ spin.style.display='none'; }

    document.getElementById('askBtn').onclick = async ()=>{
      const q = qEl.value.trim();
      if(!q){ show('<i>Inserisci una domanda.</i>'); return; }
      start();
      try{
        const r = await fetch('/api/ask', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ q })
        });
        const data = await r.json();
        // /api/ask restituisce HTML già pronto in data.answer
        show(data && data.answer ? data.answer : '<i>Nessuna risposta.</i>');
      }catch(e){
        show('<i>Errore di rete.</i>');
      }finally{ stop(); }
    };

    document.getElementById('getBtn').onclick = ()=>{
      const q = qEl.value.trim();
      if(!q){ show('<i>Inserisci una domanda.</i>'); return; }
      // Apre l’endpoint GET /ask?q=...
      window.location.href = '/ask?q=' + encodeURIComponent(q);
    };
  </script>
</body>
</html>
