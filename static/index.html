<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Tecnaria Sinapsi — Q/A</title>
  <style>
    :root{
      --bg1:#ff7a18; --bg2:#0f0f0f;
      --card:#111; --muted:#666; --text:#f5f5f5; --accent:#ffb35c;
      --chip:#1c1c1c; --ok:#2ecc71; --warn:#f1c40f; --bad:#e74c3c;
      --shadow:0 10px 30px rgba(0,0,0,.25);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      min-height:100dvh;
      background: linear-gradient(120deg,var(--bg1),var(--bg2));
      display:flex; flex-direction:column;
    }
    header{
      padding:28px 24px; display:flex; align-items:center; gap:18px;
    }
    .logo{
      width:42px; height:42px; border-radius:12px;
      background: radial-gradient(closest-side,#fff2,transparent), #0008;
      display:grid; place-items:center; box-shadow:var(--shadow);
      font-weight:800; letter-spacing:.5px;
    }
    .title h1{margin:0; font-size:22px}
    .title p{margin:4px 0 0; color:#ddd; font-size:13px}
    main{
      display:grid; grid-template-columns: minmax(320px, 740px) 1fr;
      gap:22px; padding:0 24px 32px; flex:1;
    }
    .left{display:flex; flex-direction:column; gap:16px}
    .search{
      background: #ffffff10; border:1px solid #ffffff1a; border-radius:16px; padding:14px; backdrop-filter: blur(6px);
      display:flex; gap:10px; align-items:center; box-shadow:var(--shadow)
    }
    .search input{
      flex:1; background:transparent; border:none; outline:none; color:var(--text);
      font-size:16px; padding:8px;
    }
    .btn{
      background:#fff; color:#111; border:none; font-weight:700; border-radius:12px; padding:10px 14px; cursor:pointer;
    }
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{
      background:var(--chip); border:1px solid #ffffff20; border-radius:999px; padding:8px 12px; font-size:13px; cursor:pointer;
    }
    .panel{
      background:#0a0a0a; border:1px solid #ffffff12; border-radius:18px; padding:18px; min-height:220px; box-shadow:var(--shadow)
    }
    .panel h3{margin:0 0 10px}
    .meta{font-size:12px; color:var(--muted); display:flex; gap:10px; align-items:center; margin-bottom:10px}
    .tag{background:#ffffff14; padding:4px 8px; border-radius:999px; font-size:12px}
    .right{display:flex; flex-direction:column; gap:16px}
    .card{
      background:#0b0b0b; border:1px solid #ffffff12; border-radius:18px; padding:18px; box-shadow:var(--shadow)
    }
    .status-dot{width:10px; height:10px; border-radius:50%;}
    .ok{background:var(--ok)} .bad{background:var(--bad)}
    .small{font-size:12px;color:var(--muted)}
    footer{padding:14px 24px; color:#bbb; font-size:12px}
    .answer{white-space:pre-wrap; line-height:1.5}
    .muted{color:#cfcfcf}
  </style>
</head>
<body>
  <header>
    <div class="logo">TS</div>
    <div class="title">
      <h1>Trova la soluzione, in linguaggio Tecnaria.</h1>
      <p>Assistente Q/A ufficiale • solo prodotti Tecnaria • risposte filtrate e curate</p>
    </div>
  </header>

  <main>
    <section class="left">
      <div class="search">
        <input id="q" placeholder="Chiedi a Sinapsi (es. “Mi parli della P560?”)" />
        <button class="btn" id="askBtn">Chiedi a Sinapsi</button>
      </div>
      <div class="chips">
        <div class="chip" data-q="Mi parli della P560?">P560</div>
        <div class="chip" data-q="Differenza tra CTL e CTL MAXI?">CTL vs CTL MAXI</div>
        <div class="chip" data-q="CTF su lamiera 2×1,0 mm: accortezze in posa?">CTF su lamiera</div>
        <div class="chip" data-q="Codici CTF e come fare un ordine?">Codici / ordini</div>
        <div class="chip" data-q="Differenza tra CTF e VCEM?">Comparazioni</div>
      </div>

      <div class="panel" id="answerPanel">
        <div class="meta" id="meta"></div>
        <h3 id="qTitle" class="muted">Fai una domanda per iniziare</h3>
        <div class="answer" id="answerText"></div>
      </div>
    </section>

    <aside class="right">
      <div class="card">
        <h3>Impostazioni</h3>
        <div class="small">Base URL servizio: <code id="baseUrl"></code></div>
        <div class="small">Endpoint: <code>/qa/ask</code></div>
        <div class="small">Dataset: <code>static/data/tecnaria_gold.json</code></div>
        <div class="small" id="healthRow">
          Stato: <span class="status-dot bad"></span> <span id="healthText">offline</span>
        </div>
      </div>
      <div class="card">
        <h3>Note</h3>
        <p class="small">Solo prodotti Tecnaria. Le risposte sono filtrate dal knowledge base tecnico e migliorate con narrazione “gold”.</p>
      </div>
    </aside>
  </main>

  <footer>© Tecnaria — Sinapsi Q/A • UI stabile (gradiente arancio → nero) • v1</footer>

  <script>
    const askBtn = document.getElementById('askBtn');
    const qInput = document.getElementById('q');
    const baseUrl = window.location.origin;
    document.getElementById('baseUrl').textContent = baseUrl;

    async function pingHealth(){
      try{
        const r = await fetch('/health');
        const j = await r.json();
        document.querySelector('#healthRow .status-dot').classList.remove('bad');
        document.querySelector('#healthRow .status-dot').classList.add('ok');
        document.getElementById('healthText').textContent = `online • items: ${j.items_loaded}`;
      }catch(e){
        document.querySelector('#healthRow .status-dot').classList.remove('ok');
        document.querySelector('#healthRow .status-dot').classList.add('bad');
        document.getElementById('healthText').textContent = 'offline';
      }
    }
    pingHealth();

    async function ask(q){
      const panel = document.getElementById('answerPanel');
      const meta = document.getElementById('meta');
      const qTitle = document.getElementById('qTitle');
      const aText = document.getElementById('answerText');
      qTitle.textContent = '...';
      aText.textContent = '';
      meta.innerHTML = '';
      try{
        const r = await fetch('/qa/ask?q=' + encodeURIComponent(q));
        const j = await r.json();
        if(j.error){
          qTitle.textContent = 'Domanda non valida';
          aText.textContent = (j.error || '') + (j.examples ? `\n\nEsempi:\n- ${j.examples.join('\n- ')}`:'');
          return;
        }
        meta.innerHTML = `<span class="tag">Famiglia: ${j.family || '-'}</span><span class="tag">Score: ${j.score}</span>`;
        qTitle.textContent = 'Q: ' + j.question;
        aText.textContent = j.answer || '—';
      }catch(e){
        qTitle.textContent = 'Errore di rete';
        aText.textContent = String(e);
      }
    }

    askBtn.addEventListener('click', ()=> {
      if(qInput.value.trim()) ask(qInput.value.trim());
    });
    qInput.addEventListener('keydown', (e)=> {
      if(e.key === 'Enter' && qInput.value.trim()) ask(qInput.value.trim());
    });
    document.querySelectorAll('.chip').forEach(ch => {
      ch.addEventListener('click', ()=> ask(ch.dataset.q));
    });
  </script>
</body>
</html>
