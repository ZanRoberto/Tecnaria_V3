<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Tecnaria QA Bot</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
           margin:0; background: #0b0f14; color: #e6edf3; }
    header { padding: 18px 20px; border-bottom:1px solid #1f2630; display:flex; gap:12px; align-items:center;}
    header h1 { font-size: 18px; margin:0; font-weight:600; }
    .container { max-width: 920px; margin: 24px auto; padding: 0 16px; }
    .panel { background:#0f1621; border:1px solid #1f2630; border-radius:14px; padding:18px; }
    label { display:block; font-size:13px; opacity:.85; margin-bottom:6px;}
    textarea { width:100%; min-height: 90px; border-radius:12px; background:#0b1220; color:#e6edf3;
               border:1px solid #223049; padding:12px; resize:vertical; }
    .actions { margin-top:10px; display:flex; gap:10px; }
    button { background:#1b67f3; color:#fff; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; }
    button.secondary { background:#111723; color:#dbe7ff; border:1px solid #223049; }
    .card { background:#0f1621; border:1px solid #1f2630; border-radius:14px; padding:16px; margin-top:16px; }
    .card h2 { font-size:16px; margin:0 0 8px 0; }
    .card p { margin: 8px 0; line-height:1.45; }
    .sources { margin-top:10px; opacity:.95 }
    .sources a { color:#8ab4ff; text-decoration:none; }
    .sources a:hover { text-decoration:underline; }
    footer { opacity:.7; font-size:12px; margin-top:8px; }
  </style>
</head>
<body>
  <header>
    <h1>üáÆüáπ Tecnaria QA Bot</h1>
  </header>
  <div class="container">
    <div class="panel">
      <label for="q">Domanda</label>
      <textarea id="q" placeholder="Es. Qual √® la differenza tra CTF e Diapason?"></textarea>
      <div class="actions">
        <button onclick="ask()">Chiedi</button>
        <button class="secondary" onclick="clearAns()">Pulisci</button>
        <button class="secondary" onclick="copyAns()">Copia risposta</button>
        <label style="margin-left:auto; font-size:12px; opacity:.7">
          <input type="checkbox" id="useGet" /> usa GET (debug)
        </label>
      </div>
    </div>
    <div id="answer"></div>
  </div>

<script>
async function ask(){
  const q = document.getElementById('q').value.trim();
  const useGet = document.getElementById('useGet').checked;
  const box = document.getElementById('answer');
  if(!q){ return; }
  box.innerHTML = `<div class="card"><h2>Risposta Tecnaria</h2><p>Sto componendo la risposta‚Ä¶</p></div>`;
  try{
    let html = "";
    if(useGet){
      const r = await fetch(`/ask?q=${encodeURIComponent(q)}`);
      html = await r.text();
    }else{
      const r = await fetch('/api/ask',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({q})});
      const js = await r.json();
      if(js.ok){ html = js.answer_html; } else { html = `<div class="card"><p>Errore: ${js.error||"richiesta non valida"}</p></div>`; }
    }
    // inietto HTML ‚Äúcard‚Äù gi√† pronto (cliccabile e tipografico)
    box.innerHTML = html;
  }catch(e){
    box.innerHTML = `<div class="card"><p>Errore di rete.</p></div>`;
  }
}
function clearAns(){ document.getElementById('answer').innerHTML = ""; }
function copyAns(){
  const tmp = document.createElement('div');
  tmp.innerHTML = document.getElementById('answer').innerHTML;
  const text = tmp.innerText;
  navigator.clipboard.writeText(text||"");
}
</script>
</body>
</html>

