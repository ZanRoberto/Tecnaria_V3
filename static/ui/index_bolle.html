<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tecnaria ‚Äî BOT</title>
<style>
  :root{--bg:#0b0d10;--panel:#121418;--panel2:#1a1d23;--ink:#f3f4f6;--muted:#9ca3af;--brand:#ff7a00;--brand2:#ff9833}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 600px at 70% -10%, #1f232b 0%, #0b0d10 60%);color:var(--ink);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:960px;margin:auto;padding:24px}
  .hdr{display:flex;gap:12px;align-items:center;margin-bottom:10px}
  .logo{display:grid;place-items:center;width:34px;height:34px;border-radius:9px;background:linear-gradient(145deg,#ff8800,#995100);font-weight:800}
  h1{margin:0;font-size:22px}.sub{color:var(--muted);font-size:12px}
  .row{display:flex;gap:10px;margin:14px 0}
  .in{flex:1;background:#1a1e25;border:1px solid #2a2f39;border-radius:14px;padding:14px 16px;color:var(--ink);font-size:16px;outline:none}
  .btn{background:linear-gradient(145deg,var(--brand),var(--brand2));border:0;border-radius:14px;color:#111;padding:14px 18px;font-weight:800;cursor:pointer;box-shadow:0 12px 34px rgba(255,122,0,.25)}
  .hint{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
  .tag{padding:6px 10px;border-radius:999px;background:#141821;border:1px solid #2a2f39;color:#e5e7eb;font-size:12px;cursor:pointer}
  .chat{background:var(--panel2);border:1px solid #20252e;border-radius:16px;height:62vh;min-height:380px;overflow:auto;padding:16px;box-shadow:0 14px 40px rgba(0,0,0,.35)}
  .b{max-width:78%;padding:12px 14px;border-radius:14px;margin:8px 0;line-height:1.55}
  .user{margin-left:auto;background:#e7f0ff;color:#111;border:1px solid #c7dcff}
  .bot{background:#11151b;border:1px solid #2a2f39}
  .bot h2{margin:0 0 6px 0;color:var(--brand)}
  .meta{color:#9ca3af;font-size:12px;margin-top:6px}
  .foot{color:#9ca3af;font-size:12px;margin-top:10px}
</style>
</head>
<body>
<div class="wrap">
  <div class="hdr">
    <div class="logo">T</div>
    <div><h1>Tecnaria ‚Äî BOT</h1><div class="sub">CTF ‚Ä¢ CEM-E (CTCEM/VCEM) ‚Ä¢ SPIT P560 ‚Ä¢ CTL ‚Ä¢ GTS</div></div>
  </div>

  <div class="row">
    <input id="q" class="in" placeholder="Scrivi la domanda‚Ä¶ (es. ‚ÄòMi parli della P560?‚Äô)" autofocus>
    <button class="btn" onclick="send()">Chiedi</button>
  </div>

  <div class="hint">
    <div class="tag" onclick="quick('CTCEM usa resine?')">CTCEM ‚Ä¢ Resine</div>
    <div class="tag" onclick="quick('CTF su lamiera grecata?')">CTF ‚Ä¢ Lamiera</div>
    <div class="tag" onclick="quick('Mi parli della P560 e dei chiodi HSBR14?')">P560 ‚Ä¢ HSBR14</div>
    <div class="tag" onclick="quick('Tempi di presa CEM-E a 10¬∞C?')">CEM-E ‚Ä¢ 10¬∞C</div>
    <div class="tag" onclick="quick('VCEM su essenze dure?')">VCEM ‚Ä¢ Essenze</div>
  </div>

  <div id="chat" class="chat">
    <div class="b bot">Ciao üëã Scrivi una domanda libera. Es.: <em>‚ÄúMi parli della P560?‚Äù</em></div>
  </div>

  <div class="foot">Endpoint: <code>POST /api/ask</code> (stessa origine)</div>
</div>

<script>
const BACKEND = "/api/ask"; // <-- stessa origine = niente CORS

function el(h){ const d=document.createElement('div'); d.innerHTML=h; return d.firstElementChild; }
function bottom(n){ n.scrollTop = n.scrollHeight; }
function quick(t){ document.getElementById('q').value = t; send(); }

// espansione leggera per sinonimi (migliora i match)
function expand(q){
  const Q = q.toLowerCase(), extra=[];
  if (Q.includes("p560") || Q.includes("p-560") || Q.includes("spit")) extra.push("SPIT P560","P-560","HSBR14","propulsori P560");
  if (/\bctf\b/i.test(q))  extra.push("connettori CTF","lamiera grecata","HSBR14");
  if (/\bctl\b/i.test(q))  extra.push("connettori CTL","viti","legno calcestruzzo");
  if (/cem[- ]?e/i.test(q)) extra.push("resina CEM-E","preforo","pulizia foro");
  if (/\bctcem\b/i.test(q)) extra.push("piastra dentata","preforo √ò11 75 mm","a secco");
  if (/\bvcem\b/i.test(q))  extra.push("legno calcestruzzo","a secco","piastra maggiorata");
  return [q].concat(extra).join(" ");
}

async function send(){
  const inp = document.getElementById('q');
  const chat = document.getElementById('chat');
  let q = (inp.value||"").trim(); if(!q) return;

  chat.appendChild(el(`<div class="b user"></div>`)).textContent = q;
  const holder = el(`<div class="b bot"><div class="meta">Sto chiedendo al BOT‚Ä¶</div></div>`);
  chat.appendChild(holder); bottom(chat);

  try{
    const t0 = performance.now();
    const res = await fetch(BACKEND, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ q: expand(q) })
    });
    const data = await res.json();
    const took = data.ms ? data.ms : Math.round(performance.now()-t0) + " ms";
    holder.innerHTML = (data.html || ("<pre>"+JSON.stringify(data,null,2)+"</pre>"))
                     + `<div class="meta">${took}${data.match_id ? " ‚Ä¢ match: " + data.match_id : ""}</div>`;
  }catch(e){
    holder.innerHTML = "<div><h2>Errore</h2><div>Impossibile contattare /api/ask.</div></div>" +
      "<div class='meta'>Se sei su un dominio diverso, abilita CORS sul backend o apri questa pagina da tecnaria-v3.onrender.com</div>";
  }
  bottom(chat);
}
</script>
</body>
</html>
