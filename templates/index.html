<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>Tecnaria ¬∑ Assistente documentale</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    header { display:flex; align-items:center; gap:12px; }
    header img { height:44px; }
    h1 { font-size: 20px; margin: 0; }
    .bar { margin: 14px 0; display:flex; gap: 8px; flex-wrap: wrap; }
    button { padding: 8px 12px; border-radius: 8px; border:1px solid #ccc; cursor:pointer; }
    input { width: 100%; max-width: 720px; padding: 10px; border-radius: 8px; border:1px solid #ccc; }
    .answer { background:#f7f7f9; border:1px solid #e5e5ef; padding:12px; border-radius:8px; white-space:pre-wrap; }
    .muted { color:#666; font-size: 13px; }
    .debug { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; color:#333; }
    .welcome { padding:12px; background:#eef7ff; border:1px solid #cde6ff; border-radius:8px; max-width: 720px; }
  </style>
</head>
<body>
  <header>
    <img src="/static/logo.png" alt="Logo" onerror="this.style.display='none'">
    <h1>Tecnaria ¬∑ Assistente documentale</h1>
  </header>

  <div class="bar">
    <button onclick="reloadIdx()">Ricarica indice</button>
    <button onclick="health()">Health</button>
  </div>

  <div id="info" class="muted">
    üëã Benvenuto nell‚Äôassistente documentale Tecnaria.<br/>
    Carica i file .txt in <code>documenti_gTab/</code>, premi ‚ÄúRicarica indice‚Äù e inizia a fare domande.
  </div>

  <div style="margin:14px 0;">
    <input id="q" placeholder="Chiedi a Tecnaria (es: orari sede, P560, CTF su lamiera, riprese di getto‚Ä¶)" />
    <div class="bar">
      <button onclick="ask()">Chiedi</button>
    </div>
  </div>

  <div id="welcome" class="welcome">
    Questo messaggio scompare alla prima risposta.<br/>
    Scrivi la tua domanda qui sopra e premi ‚ÄúChiedi‚Äù.
  </div>

  <div id="out" class="answer" style="display:none;"></div>
  <details style="margin-top:8px;">
    <summary class="muted">Mostra debug</summary>
    <pre id="debug" class="debug"></pre>
  </details>

  <script>
    async function reloadIdx(){
      const r = await fetch('/reload', {method:'POST'});
      const j = await r.json();
      document.getElementById('info').textContent =
        'Indice ricaricato: ' + j.blocks + ' blocchi / ' + j.docs + ' file / ' + j.lines + ' righe';
    }

    async function health(){
      const r = await fetch('/health');
      const j = await r.json();
      document.getElementById('info').textContent =
        'Health: '+j.status+' | blocchi='+j.blocks+' | docs='+j.docs+' | lines='+j.lines;
    }

    async function ask(){
      const q = document.getElementById('q').value;
      const r = await fetch('/ask', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({q})
      });
      const j = await r.json();
      document.getElementById('welcome').style.display = 'none';
      const out = document.getElementById('out');
      out.style.display = 'block';
      out.textContent = j.answer || '(nessuna risposta)';
      document.getElementById('debug').textContent = JSON.stringify(j.debug, null, 2);
    }
  </script>
</body>
</html>
